<br>
<br>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<div>
  <mat-card class="col-lg-11" style="margin-left: auto; margin-right: auto; background-color: #F5F5F5;">
  <div class="col-lg-10" style="margin-left: auto; margin-right: auto;">
        <div class='row'>
          <div class='col-sm-3'>
            <select #searchArea class="searchdropdown" id="searchDropdown">
              <option value='name'>Search by...</option>
              <option disabled='disabled'>----</option>
              <option value="name">Exercise Name</option>
              <option value="location">Location</option>
            </select>
          </div>
          <div class="col-sm-5 right">
            <div class="input-group mb-3 searchbar" id="custom-search-input">
              <input type="text" class="form-control" placeholder="Search Term" (keyup)="SearchExercises(searchValue.value, searchArea.value)" aria-label="Search for exercise here..." aria-describedby="basic-addon2" #searchValue>
              <span class="input-group-btn">
                <button class="btn btn-info btn-lg" type="button" location="top" ngbTooltip="Search">
                  <fa name="search"></fa>
                </button>
              </span>
            </div>
          </div>
        </div>
        <div class="row">
            <div class="pull-right" style="margin-left: auto;">
                <button type="button"class="btn btn-primary createbtn" (click)="open(newmodal)">Add New Exercise</button>              
            </div>
        </div>

      <ng-template #newmodal let-c="close" let-d="dismiss">
          <div class="modal-header">
            <h4 class="modal-title">New Exercise</h4>
          </div>
          <div class="modal-body">
            <span>Fill out the following...</span>
          <br><br>
            <div class="form-group row">
              <label for="inputName" class="col-sm-3 col-form-label"><b>Name</b></label>
              <div class="col-sm-9">
                <input type="text" class="form-control" id="inputName" placeholder="Exercise Name" #name>
              </div>
            </div>
            <div class="form-group row">
              <label for="inputDescrip" class="col-sm-3 col-form-label"><b>Description</b></label>
                <div class="col-sm-9">
                  <input type="text" class="form-control" id="inputDescrip" placeholder="Description" #description>
                </div>
            </div>
            <div class="form-group row">
              <label for="inputObjs" class="col-sm-3 col-form-label"><b>Objectives</b></label>
              <div class="col-sm-9">
                  <input type="text" class="form-control" id="inputObjs" placeholder="Objectives" #objectives>
                </div>
            </div>
            <div class="form-group row">
                <label for="inputAuthName" class="col-sm-3 col-form-label"><b>Author Name</b></label>
                <div class="col-sm-9">
                    <input type="text" class="form-control" id="inputAuthName" placeholder="Author Name" #authorName>
                  </div>
            </div>
            <div class="form-group row">
                <label for="inputActSteps" class="col-sm-3 col-form-label"><b>Action Steps</b></label>
                <div class="col-sm-9">
                    <input type="text" class="form-control" id="inputActSteps" placeholder="1. List Your Steps 2. Like This" #actionSteps>
                  </div>
            </div>
            <div class="form-group row">
                <label for="inputLoc" class="col-sm-3 col-form-label"><b>Location</b></label>
                <div class="col-sm-9">
                    <input type="text" class="form-control" id="inputLoc" placeholder="Location" #location>
                  </div>
            </div>
            <div class="form-group row">
                <label for="inputFreq" class="col-sm-3 col-form-label"><b>Sets</b></label>
                <div class="col-sm-9">
                    <input type="text" class="form-control" id="inputFreq" placeholder="Frequency" #frequency>
                  </div>
            </div>
            <div class="form-group row">
                <label for="inputDur" class="col-sm-3 col-form-label"><b>Repetitions</b></label>
                <div class="col-sm-9">
                    <input type="text" class="form-control" id="inputDur" placeholder="Duration" #duration>
                  </div>
            </div>
            <div class="form-group row">
                <label for="inputTargDate" class="col-sm-3 col-form-label"><b>Target Date</b></label>
                <div class="col-sm-9 row">
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="inputDur" placeholder="YYYY" #year>
                        </div>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="inputDur" placeholder="MM" #month>
                        </div>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="inputDur" placeholder="DD" #day>
                        </div>
                  </div>
            </div>
            <div class="form-group row">
              <label for="inputMedia" class="col-sm-3 col-form-label"><b>Multimedia</b></label>
              <div class="col-sm-9">
                <label class="btn btn-block btn-file" id="inputMedia">
                  Click Here to Select File(s) for Upload&hellip;
                  <input class="form-control" ng2FileSelect type="file" [uploader]="uploader" style="display: none;" accept=".jpg, .png"  multiple>
                </label>
                <td nowrap>
                  <button type="button" class="btn btn-success btn-s"
                  (click)="uploader.uploadAll()" [disabled]="!uploader.getNotUploadedItems().length">
                    <span class="glyphicon glyphicon-upload"></span> Upload all
                  </button>
                  <button type="button" class="btn btn-danger btn-m col-sm-10"
                  (click)="uploader.clearQueue()" [disabled]="!uploader.queue.length">
                    <span class="glyphicon glyphicon-trash"></span> Remove all
                  </button>
                  <tr *ngFor="let item of uploader.queue">
                    <td><strong>{{ item?.file?.name }}</strong></td>
                  </tr>
                </td>
              </div>
            </div>
            <!-- above is the form for creating a new exercise, below the button to save it -->

            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-sm" (click)="addExercise(name.value, description.value, objectives.value, authorName.value, actionSteps.value, location.value, frequency.value, duration.value, year.value, month.value, day.value); c('Close click') ">Add</button>
                <button type="button" class="btn btn-secondary btn-sm" (click)="c('Close click')">Cancel</button>                
            </div>  
          </div>
        </ng-template>
    <br><br>

    <div>
        <mat-paginator [length]="length" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions" (page)="pageEvent = $event" (page)="SetOffset(searchValue.value, searchArea.value, $event)">
          </mat-paginator>
    </div>
    <mat-accordion class="headers-align">
    <mat-expansion-panel *ngFor='let exercise of exercises' (click)="getExerciseImages(exercise._id)" (click)="uploader.clearQueue()" (click)="show(exercise)">
      <mat-expansion-panel-header class="row">
          <mat-panel-title class="col-sm-2" style="color: #0275d8"> 
            <h4>
                <strong>{{ exercise.name }} </strong> 
            </h4>
          </mat-panel-title>
          <mat-panel-description class="col-sm-11">
            <b>Target Area: </b> &nbsp; {{ exercise.location }}
          </mat-panel-description>
      </mat-expansion-panel-header>

      <div>
        <mat-list class="info col-md-12" style="margin-left: auto; margin-right: auto;">
          <div>
            <mat-list-item class="form-group-row">
              <div class="col-md-2">
                  <b> Name: </b> 
              </div>
              <div class="col-md">
                  {{ exercise.name }}
              </div>
            </mat-list-item>
            <mat-list-item class="form-group-row">
                <div class="col-md-2">
                    <b> Description: </b> 
                </div>
                <div class="col-md">
                    {{ exercise.description }} 
                </div>
            </mat-list-item>
            <mat-list-item class="form-group-row">
                <div class="col-md-2">
                    <b> Objectives: </b> 
                </div>
                <div class="col-md">
                    {{ exercise.objectives }}
                </div>
            </mat-list-item>
            <mat-list-item class="from-group-row">
                <div class="col-md-2">
                    <b> Author: </b> 
                </div>
                <div class="col-md">
                    {{ exercise.authorName }}
                </div>
            </mat-list-item>
            <mat-list-item class="form-group-row">
                <div class="col-md-2">
                    <b> Action Steps: </b> 
                </div>
                <div class="col-md">
                    {{ exercise.actionSteps }} 
                </div>
            </mat-list-item>
            <mat-list-item class="form-group-row">
                <div class="col-md-2">
                    <b> Sets: </b> 
                </div>
                <div class="col-md-4">
                    {{ exercise.frequency }} 
                </div>
                <div class="col-md-2">
                    <b> Repititions: </b>  
                </div>
                <div class="col-md-4">
                    {{ exercise.duration }}  
                </div>
            </mat-list-item>
            <mat-list-item class="form-group-row">
                <div class="col-md-2">
                    <b> Location: </b> 
                </div>
                <div class="col-md">
                    {{ exercise.location }}
                </div>
            </mat-list-item>
            <mat-list-item class="form-group-row">
                <div class="col-md-2">
                    <b> Target Date: </b>   
                </div>
                <div class="col-md">
                    <time datetime="yyyy-MM-dd"> {{ exercise.targetDate | date:'mediumDate' }} </time> 
                </div>
            </mat-list-item>
          </div>
        </mat-list>
        <br>
        <br>
        <mat-card class="col-md-6" *ngIf="images?.length >= 1" style="margin-left: auto; margin-right: auto;">
          <ngb-carousel *ngIf="images?.length > 0" class="carousel" #carousel>
            <ng-template ngbSlide *ngFor="let image of images">
              <img mat-card-image src="data:image/png;base64,{{image.data}}">
            </ng-template>
          </ngb-carousel>
        </mat-card>
      </div>

        <!-- when physio wants to update an exercise -->
        <ng-template #update let-c="close" let-d="dismiss">
            <div class="modal-header">
              <h4 class="modal-title">Update {{exercise.name}}</h4>
              <button type="button" class="close" aria-label="Close" (click)="c('Close click')">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                <form>
                  <div class="form-group row">
                    <label for="inputName" class="col-sm-3 col-form-label">Name</label>
                    <div class="col-sm-9">
                      <input type="text" class="form-control" id="inputName" placeholder="Exercise Name" value="{{ exercise.name }}" #newName>
                    </div>
                  </div>
                </form>
                <form>
                    <div class="form-group row">
                      <label for="inputDescrip" class="col-sm-3 col-form-label">Description</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="inputDescrip" placeholder="Description" value="{{ exercise.description }}" #newDescrip>
                      </div>
                    </div>
                </form>
                <form>
                    <div class="form-group row">
                      <label for="inputObj" class="col-sm-3 col-form-label">Objectives</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="inputObj" placeholder="Description" value="{{ exercise.objectives }}" #newObj>
                      </div>
                    </div>
                </form>
                <form>
                    <div class="form-group row">
                      <label for="inputAuth" class="col-sm-3 col-form-label">Author Name</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="inputAuth" placeholder="Author Name" value="{{ exercise.authorName }}" #newAuthName>
                      </div>
                    </div>
                </form>
                <form>
                    <div class="form-group row">
                      <label for="inputActSteps" class="col-sm-3 col-form-label">Action Steps</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="inputActSteps" placeholder="Description" value="{{ exercise.actionSteps }}" #newActSteps>
                      </div>
                    </div>
                </form>
                <form>
                    <div class="form-group row">
                      <label for="inputLoc" class="col-sm-3 col-form-label">Location</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="inputLoc" placeholder="Location" value="{{ exercise.location }}" #newLoc>
                      </div>
                    </div>
                </form>
                <form>
                    <div class="form-group row">
                      <label for="inputFreq" class="col-sm-3 col-form-label">Sets</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="inputFreq" placeholder="Frequency" value="{{ exercise.frequency }}" #newFreq>
                      </div>
                    </div>
                </form>
                <form>
                    <div class="form-group row">
                      <label for="inputDur" class="col-sm-3 col-form-label">Repetitions</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="inputDur" placeholder="Duration" value="{{ exercise.duration }}" #newDur>
                      </div>
                    </div>
                </form>
                <form id="eventForm">
                    <div class="form-group row">
                      <label for="inputDate" class="col-sm-3 col-form-label">Target Date</label>
                      <div class="col-sm-9">
                          <div class="col-sm-9 row">
                              <div class="col-sm-3">
                                  <input type="text" class="form-control"  placeholder="YYYY" #newYear>
                              </div>
                              <div class="col-sm-3">
                                  <input type="text" class="form-control" placeholder="MM" #newMonth>
                              </div>
                              <div class="col-sm-3">
                                  <input type="text" class="form-control" placeholder="DD" #newDay>
                              </div>
                        </div>
                      </div>
                    </div>
                </form>
                <form>
                    <div class="form-group row">
                      <label for="inputMedia" class="col-sm-3 col-form-label">Multimedia</label>
                      <div class="col-sm-9">
                        <label class="btn btn-block btn-file" id="inputMedia">
                          Click Here to Select File(s) for Upload&hellip;
                          <input class="form-control" ng2FileSelect type="file" [uploader]="uploader" style="display: none;" multiple>
                          <!-- <input class="form-control" ng2FileSelect type="file" style="display: none;" multiple (change)="uploadFiles(uploadFile)" ng-model="uploadFiles" #uploadFile> -->
                        </label>
                        <td nowrap>
                          <button type="button" class="btn btn-success btn-s"
                          (click)="uploader.uploadAll()" [disabled]="!uploader.getNotUploadedItems().length">
                            <span class="glyphicon glyphicon-upload"></span> Upload all
                          </button>
                          <button type="button" class="btn btn-danger btn-m col-sm-10"
                          (click)="uploader.clearQueue()" [disabled]="!uploader.queue.length">
                            <span class="glyphicon glyphicon-trash"></span> Remove Queued Files
                          </button>
                          <br><br><br>
                          <tr id="removeParent" *ngFor="let image of images">
                            <div id="removeMe">
                              <td><strong>{{ image.name }}</strong></td>
                              <button type="button" class="btn btn-danger btn-sm" (click)="deleteImage(image._id)" style="float: right; margin-right:10px;">X</button>
                            </div>
                          </tr>
                          <tr *ngFor="let item of uploader.queue">Upload:
                            <td><strong>{{ item?.file?.name }}</strong></td>
                          </tr>
                        </td>
                      </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
              <button id="modalButtons" type="button" class="btn btn-primary btn-sm modal-button" [disabled]="uploader.isUploading" (click)="updateExercise( exercise._id, newName.value , newDescrip.value, newObj.value, newAuthName.value, newActSteps.value, newLoc.value, newFreq.value, newDur.value, newYear.value, newMonth.value, newDay.value); c('Close click')">Confirm</button>
              <button id="modalButtons" type="button" class="btn btn-secondary btn-sm modal-button" (click)="c('Close click')">Cancel</button>                
            </div>
          </ng-template> 

          <!-- <button class="btn btn-primary btn-sm exercisebtn" (click)="open(update)">Update</button> -->
          <!-- End of First Modal -->

          <!-- The Second Modal which will be brought up when the physiotherapist wants to delete the patient-->
          <ng-template #delete let-c="close" let-d="dismiss">
            <div class="modal-header">
              <h4 class="modal-title">Delete {{ exercise.name}}</h4>
              <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>Are you sure you wish to delete patient <b>{{exercise.name}}</b>. This action is cannot be undone. </p>
            </div>
            <div class="modal-footer info">
              <br>
              <button type="button" class="btn btn-primary btn-med" (click)="deleteExercise(exercise._id); c('Close click')">Delete</button>
              <button type="button" class="btn btn-secondary btn-med" (click)="c('Close click')">Do No Delete</button>                  
            </div>
          </ng-template>
          <!-- End of First Modal -->
        </mat-expansion-panel>
  </mat-accordion>
  </div>
</mat-card>
  
</div>